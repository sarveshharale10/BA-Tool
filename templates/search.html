{% extends "layout_graph.html" %}

{% block content %}
<section class="wrapper">
    <!-- INLINE FORM ELELEMNTS -->
    <div class="row mt">
        <div class="col-lg-12">
            <div class="form-panel">
                <form id="graph" class="form" role="form">
                    <h4 class=""><i class="fa fa-angle-right"></i> Search </h4>

                    <div class="row">
                        <div class="col-md-9 ">
                            <div class="row" style="padding: 1rem;">
                                <div class="col-md-3">
                                    <select class="form-control mt" id="type">
                                        <option value="wa">Wallet Address</option>
                                        <option value="tx">Transaction Hash</option>
                                    </select>

                                </div>
                                <div class="col-md-9">
                                    <div class="form-group mt">
                                        <label class="sr-only" for="value">Value</label>
                                        <input type="text" class="form-control" id="value" placeholder="Enter Value">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="control-label">Start Time</label>
                                    <div data-date="2009-01-01T10:05:00Z" class="input-group date form_datetime-adv">
                                        <input type="text" class="form-control" id="start" readonly="" size="16">
                                        <div class="input-group-btn">
                                            <button type="button" class="btn btn-theme date-set"><i
                                                    class="fa fa-calendar"></i></button>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-md-6">
                                    <label class="control-label">End Time</label>
                                    <div data-date="2014-02-01T10:05:00Z" class="input-group date form_datetime-adv">
                                        <input type="text" class="form-control" id="end" readonly="" size="16">
                                        <div class="input-group-btn">
                                            <button type="button" class="btn btn-theme date-set"><i
                                                    class="fa fa-calendar"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-md-3 mt">
                            <div class="text-center">

                                &nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                <div class="slider-labal">
                                    <label class="switching">
                                        <strong>
                                            Show Address Clusters
                                            <input type="checkbox" id="cluster">
                                            <span class="slider round"></span>
                                        </strong>
                                    </label>
                                </div>

                                <button type="submit" class="btn btn-theme"> Generate Graph </button>

                            </div>

                        </div>


                </form>

            </div>
            <!-- /form-panel -->
            <br>
        </div>

        <!-- /col-lg-12 -->
        <div class="row mt">
            <div class="col-lg-12">
                <div id="display-graph" class="form-panel form"
                    style="display: none; position: relative; height:55vh; padding: 2.5vh;">
                    <span class="fullscreen">
                        <i id="fullscreen-btn" class="fa fa-expand"></i>
                    </span>


                    <div class="col-lg-12" id="neo4jd3"
                        style="height: 50vh; box-sizing: border-box; width: inherit; z-index: inherit;"></div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Scripts -->
{% endblock content %}
{% block scripts %}
<script type='text/javascript'>
    /* attach a submit handler to the form */
    $("#graph").submit(function (event) {

        event.preventDefault();
        type = $('#type :selected').val();
        console.log($("#start").val());

       if (type == 'wa') {
            url = '/api/address';
            var posting = $.post(url, { address: $('#value').val(), cluster: $("#cluster").is(":checked"), start:$("#start").val(), end:$("#end").val() });
        } else {
            url = '/api/transaction';
            var posting = $.post(url, { tx_hash: $('#value').val(), cluster: $("#cluster").is(":checked") });
        }
        posting.done(function (result) {
            console.log('results:' + result)
            data = {
                "results": [{
                    "data": [{ "graph": result }]
                }],
                "errors": []
            }
            if ((result['nodes'].length) > 0) {
                $('#display-graph').css('display', 'block');
                console.log(result['nodes']);
            }
            else {
                $('#display-graph').css('display', 'none');
                alert('No resut found.')
            }
            var neo4jd3 = new Neo4jd3('#neo4jd3', {
                minCollision: 60,
                neo4jData: data,
                nodeRadius: 25,
                zoomFit: false
            });
        });

    });

</script>
{% endblock scripts %}